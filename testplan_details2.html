{% extends "base.html" %}
{% load static %}

{% block title %}View Testplan - {{ testplan.name }}{% endblock %}

{% block content %}
<div class="container mx-auto p-4 bg-white shadow-md rounded-lg mb-4">
    <h2 class="text-lg font-bold mb-4">View Testplan</h2>
    
    <!-- Tabs Header -->
    <div class="mb-4 border-b">
        <ul class="flex">
            <li class="mr-4">
                <a href="#" id="tab-testplan" class="tab-link text-blue-600 font-bold" onclick="showTab('testplan'); return false;">Testplan</a>
            </li>
            <li>
                <a href="#" id="tab-checklist" class="tab-link text-gray-600" onclick="showTab('checklist'); return false;">Checklist</a>
            </li>
        </ul>
    </div>
    
    <!-- Tab Content -->
    <div id="content-testplan" class="tab-content">
        <!-- Testplan Information -->
        <div class="mb-4">
            <p class="text-sm mb-1"><strong>Name:</strong> {{ testplan.name }}</p>
            <p class="text-sm mb-1"><strong>Description:</strong> {{ testplan.description }}</p>
            <p class="text-sm mb-1"><strong>Reservation UID:</strong> {{ reservation.uid }}</p>
            <p class="text-sm mb-1"><strong>Created At:</strong> {{ testplan.created_at }}</p>
            <p class="text-sm mb-1"><strong>Updated At:</strong> {{ testplan.updated_at }}</p>
        </div>
        <!-- Steps Inserted by the User -->
        {% if steps %}
        <div>
            <h3 class="text-md font-bold mb-2">Testplan Steps</h3>
            <table class="min-w-full table-auto border-collapse">
                <thead>
                    <tr class="bg-gray-200">
                        <th class="px-2 py-1">Section</th>
                        <th class="px-2 py-1">Step Order</th>
                        <th class="px-2 py-1">Step</th>
                        <th class="px-2 py-1">Procedure</th>
                        <th class="px-2 py-1">Duration</th>
                        <th class="px-2 py-1">NQ Duration</th>
                        <th class="px-2 py-1">Executor</th>
                        <th class="px-2 py-1">Comments</th>
                    </tr>
                </thead>
                <tbody>
                    {% for step in steps %}
                    <tr class="border-b">
                        <td class="px-2 py-1 text-sm">{{ step.get_section_display }}</td>
                        <td class="px-2 py-1 text-sm">{{ step.step_order }}</td>
                        <td class="px-2 py-1 text-sm">{{ step.step }}</td>
                        <td class="px-2 py-1 text-sm">{{ step.procedure }}</td>
                        <td class="px-2 py-1 text-sm">{{ step.day_time_duration }}</td>
                        <td class="px-2 py-1 text-sm">{{ step.nq_duration }}</td>
                        <td class="px-2 py-1 text-sm">{{ step.executor }}</td>
                        <td class="px-2 py-1 text-sm">{{ step.comments }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
            <p class="text-sm">No steps have been added to this testplan.</p>
        {% endif %}
    </div>
    
    <div id="content-checklist" class="tab-content hidden">
        {% if checklist %}
        <div class="mb-4">
            <h3 class="text-md font-bold mb-2">Checklist Details</h3>
            <table class="min-w-full table-auto border-collapse">
                <tbody>
                    <tr>
                        <td class="border p-1 font-bold">Support Assistance:</td>
                        <td class="border p-1">{{ checklist.support_assistance }}</td>
                    </tr>
                    <tr>
                        <td class="border p-1 font-bold">Support Workcenter:</td>
                        <td class="border p-1">{{ checklist.support_workcenter }}</td>
                    </tr>
                    <tr>
                        <td class="border p-1 font-bold">Safety Risks:</td>
                        <td class="border p-1">{{ checklist.safety_risks }}</td>
                    </tr>
                    <tr>
                        <td class="border p-1 font-bold">Safety Overrides:</td>
                        <td class="border p-1">{{ checklist.safety_overrides }}</td>
                    </tr>
                    <tr>
                        <td class="border p-1 font-bold">Software Changes:</td>
                        <td class="border p-1">{{ checklist.software_changes }}</td>
                    </tr>
                    <tr>
                        <td class="border p-1 font-bold">Software Changes Stay:</td>
                        <td class="border p-1">{{ checklist.software_changes_stay }}</td>
                    </tr>
                    <tr>
                        <td class="border p-1 font-bold">Software Devpatch:</td>
                        <td class="border p-1">{{ checklist.software_devpatch }}</td>
                    </tr>
                    <tr>
                        <td class="border p-1 font-bold">Software Dolly Devbench:</td>
                        <td class="border p-1">{{ checklist.software_dolly_devbench }}</td>
                    </tr>
                    <tr>
                        <td class="border p-1 font-bold">Hardware Recipes:</td>
                        <td class="border p-1">{{ checklist.hardware_recipes }}</td>
                    </tr>
                    <tr>
                        <td class="border p-1 font-bold">Hardware Changes:</td>
                        <td class="border p-1">{{ checklist.hardware_changes }}</td>
                    </tr>
                    <tr>
                        <td class="border p-1 font-bold">Hardware Changes Stay:</td>
                        <td class="border p-1">{{ checklist.hardware_changes_stay }}</td>
                    </tr>
                    <tr>
                        <td class="border p-1 font-bold">Hardware Arrangement:</td>
                        <td class="border p-1">{{ checklist.hardware_arrangement }}</td>
                    </tr>
                    <tr>
                        <td class="border p-1 font-bold">Config HW Requirements:</td>
                        <td class="border p-1">{{ checklist.config_hw_requirements }}</td>
                    </tr>
                    <tr>
                        <td class="border p-1 font-bold">Config SW Requirements:</td>
                        <td class="border p-1">{{ checklist.config_sw_requirements }}</td>
                    </tr>
                    <tr>
                        <td class="border p-1 font-bold">Tools Dev Reticles:</td>
                        <td class="border p-1">{{ checklist.tools_dev_reticles }}</td>
                    </tr>
                    <tr>
                        <td class="border p-1 font-bold">Tools Customer Reticles:</td>
                        <td class="border p-1">{{ checklist.tools_customer_reticles }}</td>
                    </tr>
                    <tr>
                        <td class="border p-1 font-bold">Don't Forget Recovery Time:</td>
                        <td class="border p-1">{{ checklist.dont_forget_recovery_time }}</td>
                    </tr>
                </tbody>
            </table>
        </div>
        {% else %}
            <p class="text-sm">No checklist data available.</p>
        {% endif %}
    </div>
    
    <!-- Navigation Buttons -->
    <div class="flex space-x-2 mt-8">
        <button class="bg-blue-800 hover:bg-green-500 text-white font-bold py-2 px-4 rounded"
                onclick="location.href='{% url 'reservation_detail' uid=reservation.uid %}'">
            Back to Reservation Details
        </button>
        <button class="bg-white text-blue-800 font-bold py-2 px-4 rounded border-2 border-blue-800 
                       hover:bg-green-500 hover:text-white hover:border-transparent"
                onclick="location.href='{% url 'dashboard' %}'">
            Back to Dashboard
        </button>
    </div>
</div>

<script>
function showTab(tabName) {
    // Hide all tab content
    document.querySelectorAll('.tab-content').forEach(function(el) {
        el.classList.add('hidden');
    });
    // Remove active styling from all tab links
    document.querySelectorAll('.tab-link').forEach(function(el) {
        el.classList.remove('text-blue-600', 'font-bold');
        el.classList.add('text-gray-600');
    });
    // Show selected tab content
    document.getElementById('content-' + tabName).classList.remove('hidden');
    // Mark the selected tab as active
    document.getElementById('tab-' + tabName).classList.add('text-blue-600', 'font-bold');
}
</script>
{% endblock %}
